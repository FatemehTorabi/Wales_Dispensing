---------------------------------------------------
--Project: 0911
--By: fatemeh.torabi@swansea.ac.uk
--Aim: create RRDA for WDDS
---------------------------------------------------
---------------------------------------------------
--
--STAGE 1: Code to map TO BNF 7th character using various UKHD tables
--
----------------------------------------------------

CALL FNC.DROP_IF_EXISTS ('SAILW0911V.STAGED_TAB1');
COMMIT;
----------------------------------------------------
--
--	Create Table
--
CREATE TABLE SAILW0911V.STAGED_TAB1
(
	DMDCODE_PRESCRIBED		VARCHAR(30),
	ID_TYPE					VARCHAR(4),
	ID						BIGINT,
	NM						VARCHAR(775)	
);

COMMIT;
--
CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE SAILW0911V.STAGED_TAB1 WITH DISTRIBUTION AND DETAILED INDEXES ALL');
COMMIT;

ALTER TABLE SAILW0911V.STAGED_TAB1 ACTIVATE NOT LOGGED INITIALLY;
----------------------------------------------------
--
--	Insert into Table
--
INSERT INTO SAILW0911V.STAGED_TAB1
WITH DIS_CODES	AS
(
	SELECT
	DISTINCT 
	DMDCODE_PRESCRIBED
	FROM
	SAIL0911V.WDDS_DISPENSING
	WHERE 
	DMDCODE_PRESCRIBED NOT IN 'na'  
	GROUP BY
	DMDCODE_PRESCRIBED
	ORDER BY
	DMDCODE_PRESCRIBED
)
	SELECT
	DISTINCT
	D.DMDCODE_PRESCRIBED,
	CASE
	WHEN	A.APID	 IS NOT NULL	 THEN 'APID'
	WHEN	V.VPID	 IS NOT NULL	 THEN 'VPID'
	ELSE	NULL
	END AS	ID_TYPE,
	CASE
	WHEN	A.APID	 IS NOT NULL	 THEN A.APID
	WHEN	V.VPID	 IS NOT NULL	 THEN V.VPID
	ELSE	NULL
	END AS	ID,
	CASE
	WHEN	A.APID	 IS NOT NULL	 THEN A.NM
	WHEN	V.VPID	 IS NOT NULL	 THEN V.NM
	ELSE	NULL
	END AS	NM
FROM
	DIS_CODES	D
	LEFT JOIN 
	(SELECT APID, VPID, NM FROM SAILUKHDV.DMPLUSD_AMP_ACTUAL_MEDICINAL_PRODUCTS_SCD WHERE IS_LATEST = 1) AS A 
	ON
	D.DMDCODE_PRESCRIBED	=	CAST(A.APID AS VARCHAR(30))
	LEFT JOIN 
	(SELECT VPID, NM FROM SAILUKHDV.DMPLUSD_VMP_VIRTUAL_MEDICINAL_PRODUCTS_SCD WHERE "Is_Latest" = 1) AS V
	ON
	D.DMDCODE_PRESCRIBED	=	CAST(V.VPID AS VARCHAR(30))		
GROUP BY
	D.DMDCODE_PRESCRIBED,
	CASE
	WHEN	A.APID	 IS NOT NULL	 THEN 'APID'
	WHEN	V.VPID	 IS NOT NULL	 THEN 'VPID'
	ELSE	NULL
	END,
	CASE
	WHEN	A.APID	 IS NOT NULL	 THEN A.APID
	WHEN	V.VPID	 IS NOT NULL	 THEN V.VPID
	ELSE	NULL
	END,
	CASE
	WHEN	A.APID	 IS NOT NULL	 THEN A.NM
	WHEN	V.VPID	 IS NOT NULL	 THEN V.NM
	ELSE	NULL
	END
	ORDER BY
	D.DMDCODE_PRESCRIBED;

COMMIT;

CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE SAILW0911V.STAGED_TAB1 WITH DISTRIBUTION AND DETAILED INDEXES ALL');

COMMIT;

----------------------------------------------------
--
--STAGE 2 
--
----------------------------------------------------
CALL FNC.DROP_IF_EXISTS ('SAILW0911V.STAGED_TAB2');
COMMIT;
-------------------	
--	
--	Create Table
CREATE TABLE SAILW0911V.STAGED_TAB2
(
	DMDCODE_PRESCRIBED		VARCHAR(30),
	ID_TYPE					VARCHAR(4),
	ID						BIGINT,
	NM						VARCHAR(775),
	BNF						BIGINT,
	BNF_LENGTH				INTEGER,
	BNF_UPDATED				VARCHAR(7)
);
COMMIT;

CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE SAILW0911V.STAGED_TAB2 WITH DISTRIBUTION AND DETAILED INDEXES ALL');
COMMIT;

ALTER TABLE SAILW0911V.STAGED_TAB2 ACTIVATE NOT LOGGED INITIALLY;
---------------------------------------------------
--	Insert into Table
INSERT INTO SAILW0911V.STAGED_TAB2
WITH DIS_CODES	AS
(
SELECT
	DISTINCT 
	DMDCODE_PRESCRIBED,
	ID_TYPE,
	ID,
	NM
FROM
	SAILW0911V.STAGED_TAB1
WHERE

	NM IS NOT NULL
GROUP BY 
	DMDCODE_PRESCRIBED,
	ID_TYPE,
	ID,
	NM
),
MATCHES	AS
(
SELECT 
	DISTINCT
	CD.DMDCODE_PRESCRIBED,
	CD.ID_TYPE,
	CD.ID,
	CD.NM,
	CASE
		WHEN	CD.ID_TYPE	=	'VPID'	THEN	V.BNF
		WHEN	CD.ID_TYPE	=	'APID'	THEN	A.BNF
		ELSE NULL
	END AS 	BNF
FROM
	DIS_CODES	CD
	
LEFT JOIN (SELECT VPID, BNF FROM SAILUKHDV.DMPLUSD_BNF_VIRTUAL_MEDICINAL_PRODUCTS_TO_BNF_AND_ATC_MAP_SCD WHERE "Is_Latest" = 1) AS V
ON
	CD.ID	=	V.VPID 
AND
	CD.ID_TYPE	=	'VPID'

LEFT JOIN (SELECT APID, BNF FROM SAILUKHDV.DMPLUSD_BNF_ACTUAL_MEDICINE_PRODUCTS_TO_BNF_MAP_SCD WHERE IS_LATEST = 1) AS A
ON
	CD.ID	=	A.APID 
AND
	CD.ID_TYPE	=	'APID'
		
GROUP BY
	CD.DMDCODE_PRESCRIBED,
	CD.ID_TYPE,
	CD.ID,
	CD.NM,
	CASE
		WHEN	CD.ID_TYPE	=	'VPID'	THEN	V.BNF
		WHEN	CD.ID_TYPE	=	'APID'	THEN	A.BNF
		ELSE NULL
	END
)
SELECT
	DMDCODE_PRESCRIBED,
	ID_TYPE,
	ID,
	NM,
	BNF,
	LENGTH(TRIM(BNF))	AS	BNF_LENGTH,
	CASE
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 0 THEN (0 || LEFT(BNF,6))
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 1 THEN (0 || LEFT(BNF,5) || 1)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 2 THEN (0 || LEFT(BNF,5) || 2)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 3 THEN (0 || LEFT(BNF,5) || 3)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 4 THEN (0 || LEFT(BNF,5) || 4)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 5 THEN (0 || LEFT(BNF,5) || 5)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 0 THEN LEFT(BNF,7)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 1 THEN (LEFT(BNF,6) || 1)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 2 THEN (LEFT(BNF,6) || 2)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 3 THEN (LEFT(BNF,6) || 3)
		ELSE	NULL
	END	AS	BNF_UPDATED
FROM
	MATCHES
GROUP BY
	DMDCODE_PRESCRIBED,
	ID_TYPE,
	ID,
	NM,
	BNF,
	LENGTH(TRIM(BNF)),
	CASE
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 0 THEN (0 || LEFT(BNF,6))
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 1 THEN (0 || LEFT(BNF,5) || 1)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 2 THEN (0 || LEFT(BNF,5) || 2)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 3 THEN (0 || LEFT(BNF,5) || 3)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 4 THEN (0 || LEFT(BNF,5) || 4)
		WHEN	LENGTH(TRIM(BNF)) = 7 AND	RIGHT(BNF,1) = 5 THEN (0 || LEFT(BNF,5) || 5)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 0 THEN LEFT(BNF,7)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 1 THEN (LEFT(BNF,6) || 1)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 2 THEN (LEFT(BNF,6) || 2)
		WHEN	LENGTH(TRIM(BNF)) = 8 AND	RIGHT(BNF,1) = 3 THEN (LEFT(BNF,6) || 3)
		ELSE	NULL
	END;

COMMIT;
---------------------------------------------------
CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE SAILW0911V.STAGED_TAB2 WITH DISTRIBUTION AND DETAILED INDEXES ALL');

---------------------------------------------------
--
-- BNF_DESC: 
--
---------------------------------------------------
--	
--	Create Table
CALL FNC.DROP_IF_EXISTS ('SAILW0911V.STAGED_TAB3');

CREATE TABLE SAILW0911V.STAGED_TAB3
(
	DMDCODE_PRESCRIBED		VARCHAR(30),
	ID_TYPE					VARCHAR(4),
	ID						BIGINT,
	NM						VARCHAR(775),
	BNF						BIGINT,
	BNF_LENGTH				INTEGER,
	BNF_UPDATED				VARCHAR(7),
	BNF_SUBPARAGRAPH		VARCHAR(775)
);
COMMIT;
--
CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE SAILW0911V.STAGED_TAB3 WITH DISTRIBUTION AND DETAILED INDEXES ALL');
COMMIT;

ALTER TABLE SAILW0911V.STAGED_TAB3 ACTIVATE NOT LOGGED INITIALLY;

INSERT INTO SAILW0911V.STAGED_TAB3 
	SELECT DISTINCT A.* , B.BNF_SUBPARAGRAPH 
		FROM 
		(SELECT * FROM SAILW0911V.STAGED_TAB2) A 
		LEFT JOIN 
		(SELECT * FROM SAILUKHDV.BNF_BNF_CODE_INFORMATION_SCD WHERE BNF_SUBPARAGRAPH_CODE IS NOT NULL) B 
	ON 
		A.BNF_UPDATED =B.BNF_SUBPARAGRAPH_CODE;

COMMIT;

-------------------------------------------------------------
--COMBINED: BSA AND UKHD MAPPING
-------------------------------------------------------------
CALL FNC.DROP_IF_EXISTS ('SAILW0911V.STAGED_TAB4');

CREATE TABLE SAILW0911V.STAGED_TAB4 
(
	DMD_CD_WDDS					VARCHAR(30),
	DMD_CD_BSA					VARCHAR(30),
	DMD_DESC_BSA				VARCHAR(775),
	BNF_CD_BSA					VARCHAR(225),
	BNF_NAME_BSA				VARCHAR(775),
	DMD_DESC_UKHDV				VARCHAR(775),
	BNF_UKHDV					BIGINT,
	BNF_LENGTH_UKHDV			INTEGER,
	BNF_UPDATED_UKHDV			VARCHAR(7),
	BNF_COMBINED				VARCHAR(225),
	BNF_COMBINED_DESC			VARCHAR(775)
);

COMMIT;
--
CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE  SAILW0911V.STAGED_TAB4 WITH DISTRIBUTION AND DETAILED INDEXES ALL');
COMMIT;

ALTER TABLE  SAILW0911V.STAGED_TAB4 ACTIVATE NOT LOGGED INITIALLY;
COMMIT;

--INSERT
INSERT INTO  SAILW0911V.STAGED_TAB4
(
	DMD_CD_WDDS, 
	DMD_CD_BSA, 
	DMD_DESC_BSA, 
	BNF_CD_BSA, 
	BNF_NAME_BSA,
	DMD_DESC_UKHDV, 
	BNF_UKHDV, 
	BNF_LENGTH_UKHDV,
	BNF_UPDATED_UKHDV
) 
SELECT DISTINCT 
		A.DMDCODE_PRESCRIBED dmd_CD_WDDS ,
		B.SNOMED_CD DMD_CD_BSA,
		B.DMD_PRODUCT_DESC DMD_DESC_BSA, 
		B.BNF_CD BNF_CD_BSA, 
		B.BNF_NAME BNF_NAME_BSA,
		C.nm DMD_DESC_UKHDV, 
		C.BNF BNF_UKHDV,
		C.BNF_LENGTH BNF_LENGTH_UKHDV,
		C.BNF_UPDATED BNF_UPDATED_UKHDV
		FROM 
		(SELECT * FROM SAIL0911V.WDDS_DISPENSING WHERE DMDCODE_PRESCRIBED NOT IN 'na') A
	LEFT JOIN 
		SAILW0911V.RRDA_WDDS_REF_BNF_SNOMED_MERGED B 
		ON 
		A.DMDcode_prescribed=B.SNOMED_CD
	LEFT JOIN 
  		SAILW0911V.STAGED_TAB2 C
		ON 
		A.DMDCODE_PRESCRIBED=C.DMDCODE_PRESCRIBED; 

COMMIT; 	

---------------------------------
--
--UPDATE AND CORRECT THE BNF GAPS: 
--
---------------------------------
UPDATE SAILW0911V.STAGED_TAB4
SET BNF_CD_BSA =CASE 
				WHEN BNF_CD_BSA='' THEN NULL 
				ELSE BNF_CD_BSA END; 

UPDATE SAILW0911V.STAGED_TAB4
SET BNF_COMBINED= CASE 
					WHEN BNF_CD_BSA IS NOT NULL THEN BNF_CD_BSA
					WHEN BNF_CD_BSA IS NULL THEN BNF_UPDATED_UKHDV
					ELSE NULL END; 

UPDATE SAILW0911V.STAGED_TAB4
SET BNF_COMBINED_DESC= CASE 
					WHEN BNF_CD_BSA IS NOT NULL THEN BNF_NAME_BSA
					ELSE NULL END; 

---------------------------------
--
--MERGE BNF7 DESC
--
---------------------------------
CALL FNC.DROP_IF_EXISTS ('SAILW0911V.STAGED_TAB5');

CREATE TABLE SAILW0911V.STAGED_TAB5
(
	DMD_CD_WDDS				VARCHAR(30),
	DMD_CD_BSA				VARCHAR(30),
	DMD_DESC_BSA			VARCHAR(775),
	BNF_CD_BSA				VARCHAR(225),
	BNF_NAME_BSA			VARCHAR(775),
	DMD_DESC_UKHDV			VARCHAR(775),
	BNF_UKHDV				BIGINT,
	BNF_LENGTH_UKHDV		INTEGER,
	BNF_UPDATED_UKHDV		VARCHAR(7),
	BNF_SUBPARAGRAPH		VARCHAR(775),
	BNF_COMBINED			VARCHAR(225),
	BNF_COMBINED_DESC		VARCHAR(775)
);

COMMIT;
--
CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE  SAILW0911V.STAGED_TAB5 WITH DISTRIBUTION AND DETAILED INDEXES ALL');
COMMIT;

ALTER TABLE  SAILW0911V.STAGED_TAB5 ACTIVATE NOT LOGGED INITIALLY;
COMMIT;

--INSERT
INSERT INTO  SAILW0911V.STAGED_TAB5
SELECT 
	AA.DMD_CD_WDDS, AA.DMD_CD_BSA, AA.DMD_DESC_BSA,	AA.BNF_CD_BSA ,	AA.BNF_NAME_BSA, 
	AA.DMD_DESC_UKHDV, AA.BNF_UKHDV, AA.BNF_LENGTH_UKHDV, AA.BNF_UPDATED_UKHDV, 
	B.BNF_SUBPARAGRAPH, AA.BNF_COMBINED, AA.BNF_COMBINED_DESC
FROM 
	SAILW0911V.STAGED_TAB4 AA
LEFT JOIN 	
	(
	SELECT DISTINCT BNF_SUBPARAGRAPH_CODE , BNF_SUBPARAGRAPH 
	FROM SAILUKHDV.BNF_BNF_CODE_INFORMATION_SCD
	WHERE IS_LATEST =1
	)B
ON 
AA.BNF_UPDATED_UKHDV=B.BNF_SUBPARAGRAPH_CODE;

COMMIT; 

		
----------------------------------------------
--
--FULL LINKED VERSION OF WDDS TABLE: 
--anylist NOTE: MAY NEED TO BREAK THE INSERT FOR EACH YEAR SEPARATELY 
--
----------------------------------------------
CALL FNC.DROP_IF_EXISTS ('SAILW0911V.STAGED_TAB6');

CREATE TABLE SAILW0911V.STAGED_TAB6 AS 
(
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS
)WITH NO DATA;

COMMIT;
--

CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE  SAILW0911V.STAGED_TAB6 WITH DISTRIBUTION AND DETAILED INDEXES ALL');
COMMIT;

ALTER TABLE  SAILW0911V.STAGED_TAB6 ACTIVATE NOT LOGGED INITIALLY;
COMMIT;

--INSERT: had to break the insert into years and months:
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '1'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;

INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '2'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '3'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '4'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '5'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '6'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '7'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '8'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '9'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '10'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '11'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2016' AND MONTH(DT_PRESCRIBED)= '12'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
--2017
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '1'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;

INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '2'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '3'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '4'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '5'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '6'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '7'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '8'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '9'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '10'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '11'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2017' AND MONTH(DT_PRESCRIBED)= '12'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;		
--2018
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '1'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;

INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '2'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '3'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '4'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '5'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '6'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '7'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '8'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '9'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '10'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '11'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2018' AND MONTH(DT_PRESCRIBED)= '12'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
--2019
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '1'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;

INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '2'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '3'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '4'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '5'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '6'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '7'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '8'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '9'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '10'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '11'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2019' AND MONTH(DT_PRESCRIBED)= '12'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
--2020
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '1'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;

INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '2'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '3'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '4'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '5'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '6'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '7'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '8'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '9'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '10'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '11'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2020' AND MONTH(DT_PRESCRIBED)= '12'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
--2021
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '1'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;

INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '2'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '3'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '4'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '5'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '6'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '7'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '8'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;		
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '9'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '10'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '11'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;	
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2021' AND MONTH(DT_PRESCRIBED)= '12'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;		
INSERT INTO  SAILW0911V.STAGED_TAB6
		SELECT A.*, B.DMD_CD_WDDS, B.DMD_CD_BSA, B.DMD_DESC_BSA, 
		B.BNF_NAME_BSA, B.DMD_DESC_UKHDV, B.BNF_UKHDV, B.BNF_UPDATED_UKHDV, B.BNF_SUBPARAGRAPH, 
		B.BNF_COMBINED, B.BNF_COMBINED_DESC 
		FROM 
		(
		SELECT * FROM SAIL0911V.WDDS_DISPENSING	
		WHERE DMDcode_prescribed NOT IN 'na'
		AND YEAR(DT_PRESCRIBED) = '2022' AND MONTH(DT_PRESCRIBED)= '01'
		)	A
		JOIN 
		SAILW0911V.STAGED_TAB5 B
		ON 
		A.DMDCODE_PRESCRIBED=B.DMD_CD_WDDS;		
--Update: you may require to add some insert statements once the coverage passed June
COMMIT; 

CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE SAILW0911V.STAGED_TAB6 WITH DISTRIBUTION AND DETAILED INDEXES ALL');

-------------------------------------------------------------
--
--BNF CHAPTER AND ALF: 
--
-------------------------------------------------------------
CALL FNC.DROP_IF_EXISTS ('SAILW0911V.STAGED_TAB6_alf');

CREATE TABLE SAILW0911V.STAGED_TAB6_ALF AS (
		SELECT B.ALF_E,A.* FROM 
		SAILW0911V.STAGED_TAB6 A 
		LEFT JOIN 
		SAIL0911V.WDDS_DISPENSING_ALF B 
		ON 
		A.SYSTEM_ID_E=B.SYSTEM_ID_E 
		AND 
		B.ALF_STS_CD IN ('1','4','39')
)WITH NO DATA; 

CALL SYSPROC.ADMIN_CMD('RUNSTATS ON TABLE  SAILW0911V.STAGED_TAB6_ALF WITH DISTRIBUTION AND DETAILED INDEXES ALL');
COMMIT;

ALTER TABLE  SAILW0911V.STAGED_TAB6_ALF ACTIVATE NOT LOGGED INITIALLY;
COMMIT;

--ALF 2016
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
SELECT DISTINCT B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	and
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=1;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=2;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=3;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=4;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=5;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=6;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=7;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=8;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=9;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=10;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=11;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2016' AND MONTH(A.DT_PRESCRIBED)=12;

--ALF 2017
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
SELECT DISTINCT B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=1;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=2;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=3;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=4;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=5;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=6;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=7;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=8;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=9;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=10;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=11;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2017' AND MONTH(A.DT_PRESCRIBED)=12;

---ALF 2018
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
SELECT DISTINCT B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=1;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=2;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=3;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=4;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=5;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=6;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=7;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=8;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=9;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=10;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=11;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2018' AND MONTH(A.DT_PRESCRIBED)=12;

--ALF 2019
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
SELECT DISTINCT B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=1;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=2;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=3;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=4;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=5;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=6;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=7;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=8;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=9;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=10;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=11;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2019' AND MONTH(A.DT_PRESCRIBED)=12;

---ALF 2020
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
SELECT DISTINCT B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=1;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=2;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=3;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=4;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=5;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=6;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=7;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	LEFT JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=8;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT B.ALF_E, A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=9;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=10;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.* FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=11;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2020' AND MONTH(A.DT_PRESCRIBED)=12;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=1;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=2;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=3;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=4;
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=5;
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=6;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=7;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=8;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=9;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=10;

INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=11;
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2021' AND MONTH(A.DT_PRESCRIBED)=12;
INSERT INTO SAILW0911V.STAGED_TAB6_ALF
	SELECT DISTINCT  B.ALF_E,A.*  FROM 
	SAILW0911V.STAGED_TAB6 A 
	JOIN 
	SAIL0911V.WDDS_DISPENSING_ALF B 
	ON 
	A.SYSTEM_ID_E=B.SYSTEM_ID_E 
	AND 
	b.ALF_E IS NOT NULL 
	AND 
	B.ALF_STS_CD IN ('1','4','39')WHERE YEAR(A.DT_PRESCRIBED)='2022' AND MONTH(A.DT_PRESCRIBED)=01;
--Update: you may require to add some insert statements once the coverage passed june

COMMIT;
------------------------------------------------------------
--
--WDDS COVERAGE
--
------------------------------------------------------------
WITH COV AS (
SELECT
	A.DT_PRESCRIBED AS MAX_WDDS_DT,
	A.COUNTS ,
	CAST(AVG_COUNT AS INTEGER) AVG,
	((A.COUNTS)/ AVG_COUNT) AS RATIO_TO_AVG
FROM
	(
	--a
	SELECT
	1 AS LINK ,
	DT_PRESCRIBED ,
	COUNT(*) AS COUNTS
	FROM
	SAIL0911V.WDDS_DISPENSING
	WHERE
	YEAR(DT_PRESCRIBED) >= '2020'
	AND DT_PRESCRIBED < AVAIL_FROM_DT
	GROUP BY
	DT_PRESCRIBED
	ORDER BY
	DT_PRESCRIBED DESC )a
LEFT JOIN (
	SELECT
	A.LINK,
	AVG(COUNTS*1.0) AS AVG_COUNT,
	SUM(COUNTS) AS TOTAL
	FROM
	(
	SELECT
	1 AS LINK ,
	DT_PRESCRIBED ,
	COUNT(*) AS COUNTS
	FROM
	SAIL0911V.WDDS_DISPENSING
	WHERE
	YEAR(DT_PRESCRIBED) >= '2020'
	AND DT_PRESCRIBED < AVAIL_FROM_DT
	GROUP BY
	DT_PRESCRIBED
	ORDER BY
	DT_PRESCRIBED )a
	GROUP BY
	LINK )TOTAL ON
A.LINK = TOTAL.LINK
	ORDER BY
	DT_PRESCRIBED DESC) 

SELECT
	*
FROM COV;  

--UPDATE: USE THE LAST COVERAGE DATE IS THE LAST DATE USED FOR VERSION OF THE CLEANED TABLE
------------------------------------------------------------
--
--FINAL MAPPED CLEANED TABLE
--
-------------------------------------------------------------
--CLEANED TABLE: 
--do not drop the old versions of the table at all 

--Update: you will need to update the end date tag at the end of table name to : end of coverage for WDDS data 
--This end date is the result of the coverage statement provided above or as part of the separate script in 3a. 
CREATE TABLE SAILW0911V.RRDA_WDDS_20220126 AS 
(
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
	FETCH FIRST 2 ROWS ONLY
)WITH NO DATA;

ALTER TABLE SAILW0911V.RRDA_WDDS_20220126 ACTIVATE NOT LOGGED INITIALLY;

--update: Copy the insert line and add year and month according to the new extract here i.e. if coverage now is Jan-2022 and new extract covers until Feb-2022 then you need a new insert statement with year(DT_PRESCRIBED)='2022' and MONTH(DT_PRESCRIBED)='02' 
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2022' AND MONTH(DT_PRESCRIBED)='01';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='12';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='11';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='10';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='9';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='8';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='7';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='6';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='5';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='4';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='3';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='2';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2021' AND MONTH(DT_PRESCRIBED)='1';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='1';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='2';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='3';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='4';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='5';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='6';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='7';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='8';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='9';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='10';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='11';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2020' AND MONTH(DT_PRESCRIBED)='12';


INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='1';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='2';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='3';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='4';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='5';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='6';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='7';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='8';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='9';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='10';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='11';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2019' AND MONTH(DT_PRESCRIBED)='12';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='1';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='2';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='3';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='4';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='5';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='6';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='7';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='8';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='9';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='10';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='11';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2018'AND MONTH(DT_PRESCRIBED)='12';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='1';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='2';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='3';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='4';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='5';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='6';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='7';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='8';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='9';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='10';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='11';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2017'AND MONTH(DT_PRESCRIBED)='12';

INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='1';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='2';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='3';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='4';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='5';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='6';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='7';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='8';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='9';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='10';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='11';
INSERT INTO SAILW0911V.RRDA_WDDS_20220126 
	SELECT DISTINCT ALF_E , DT_PRESCRIBED,  PRAC_CD_E ,DMDCODE_PRESCRIBED , PRODUCT_PRESCRIBED,
	QTY_PRESCRIBED ,QTY_PRESCRIBED_VAL , QTY_UOM_CODE, MONTH_DISPENSED, DISPENSER_ID, FORM_NO, 
	DMD_CD_WDDS, BNF_COMBINED, BNF_COMBINED_DESC, DMD_CD_BSA,DMD_DESC_BSA,DMD_DESC_UKHDV, BNF_NAME_BSA,  BNF_UKHDV, BNF_UPDATED_UKHDV, BNF_SUBPARAGRAPH,
	AVAIL_FROM_DT
	FROM SAILW0911V.STAGED_TAB6_ALF
WHERE ALF_E IS NOT NULL AND YEAR(DT_PRESCRIBED)='2016'AND MONTH(DT_PRESCRIBED)='12';

COMMIT;

SELECT COUNT(*), count(DISTINCT ALF_E ), count(DISTINCT dmdcode_prescribed) FROM SAILW0911V.RRDA_WDDS_20220126;
SELECT count(DISTINCT dmdcode_prescribed) FROM SAILW0911V.RRDA_WDDS_20220126 WHERE bnf_combined IS NOT null;



--	Coverage based on rules
--	0.7 (70%) OF RATIO_TO_AVG (If the coverage falls below 0.7 then 
--	wait for 2 consistent days of coverage equal to or above 0.7)
--	AVERAGE BASED ON ALL DATA FROM 2020 ONWARDS	
WITH COV AS (
SELECT
	A.DT_PRESCRIBED AS MAX_WDDS_DT,
	A.COUNTS ,
	CAST(AVG_COUNT AS INTEGER) AVG,
	((A.COUNTS)/ AVG_COUNT) AS RATIO_TO_AVG
FROM
	(
		--a
		SELECT
		1 AS LINK ,
		DT_PRESCRIBED ,
		COUNT(*) AS COUNTS
		FROM
		SAILW0911V.RRDA_WDDS_20220126
		WHERE
		YEAR(DT_PRESCRIBED) >= '2020'
		AND DT_PRESCRIBED < AVAIL_FROM_DT
		GROUP BY
		DT_PRESCRIBED
		ORDER BY
		DT_PRESCRIBED DESC 
	)a
	LEFT JOIN 
	(
		SELECT
		A.LINK,
		AVG(COUNTS*1.0) AS AVG_COUNT,
		SUM(COUNTS) AS TOTAL
		FROM
			(
			SELECT
			1 AS LINK ,
			DT_PRESCRIBED ,
			COUNT(*) AS COUNTS
			FROM
			SAILW0911V.RRDA_WDDS_20220126
			WHERE
			YEAR(DT_PRESCRIBED) >= '2020'
			AND DT_PRESCRIBED < AVAIL_FROM_DT
			GROUP BY
			DT_PRESCRIBED
			ORDER BY
			DT_PRESCRIBED 
			)a
		GROUP BY LINK 
	)TOTAL 
	ON
	A.LINK = TOTAL.LINK
	ORDER BY
	DT_PRESCRIBED DESC
) ,
ROWS_PASS AS 
(
	SELECT 	* FROM 	COV
	WHERE
	RATIO_TO_AVG >= 0.7 
),
TWO_DATES AS 
(
	SELECT
	R.*,
	LAG(R.MAX_WDDS_DT) OVER (
	ORDER BY MAX_WDDS_DT DESC) LAG_DATE
	FROM
	ROWS_PASS R
	ORDER BY
	R.MAX_WDDS_DT DESC 
)
SELECT
MAX(DATES) AS MAX_COV_WDDS1_DT
FROM
	(
	SELECT
	MAX_WDDS_DT,
	LAG_DATE,
	(MAX_WDDS_DT + 1) AS DATE_CHECK,
	CASE
	WHEN LAG_DATE = (MAX_WDDS_DT + 1) THEN LAG_DATE
	ELSE NULL
	END AS DATES
	FROM
	TWO_DATES 
);